<!DOCTYPE html>

<html>

<head>
  <title>To Do List</title>
  <style>
    div {
      margin-top: 15px;
    }
  </style>
</head>

<body>
  <h1>Todo List</h1>

  <button onclick="handlers.toggleAll()">Toggle All</button>
  <div>
    <label>New to do: </label>
    <input id="new" type="text" placeholder="Type here"></input>
    <button id="add">Add</button>
  </div>

  <div>
    <button onclick="handlers.changeTodo()">Change Todo</button>
    <input id="changePos" type="number" placeholder="Position" />
    <input id="changeText" type="text" placeholder="New text" />
  </div>

  <div>
    <button onclick="handlers.toggleTodo()">Toggle Todo</button>
    <input id="togglePos" type="number" placeholder="Position" />
  </div>

  <ul>
  </ul>

  <script>
    var todoList = {
      todos: [],
      addTodo: function (todoText) {
        this.todos.push({
          todoText: todoText,
          completed: false
        });
      },
      changeTodo: function (position, newTodoText) {
        this.todos[position].todoText = newTodoText;
      },
      deleteTodo: function (position) {
        this.todos.splice(position, 1);
      },
      toggleCompleted: function (position) {
        this.todos[position].completed = !this.todos[position].completed;
      },
      toggleAll: function () {
        var completedTodos = 0;
        this.todos.forEach((todo) => {
          todo.completed === true ? completedTodos++ : null;
        });
        this.todos.forEach((todo) => {
          if(completedTodos === this.todos.length)
            todo.completed = false;
          else
            todo.completed = true;
        });
      }
    }
    var addButton = document.getElementById("add");
    var inputNewTodo = document.getElementById("new");

    addButton.addEventListener('click', () => {
      todoList.addTodo(inputNewTodo.value);
      inputNewTodo.value = "";
    });

    var everyButton = document.querySelectorAll("button");

    for (i = 0; i < everyButton.length; i++) {
      everyButton[i].addEventListener('click', () => { view.displayTodos() });
    }

    var handlers = {
      displayTodos: () => {
        todoList.displayTodos();
      },
      toggleAll: () => {
        todoList.toggleAll();
      },
      changeTodo: () => {
        var changeTodoPos = document.getElementById("changePos");
        var changeTodoText = document.getElementById("changeText");
        todoList.changeTodo(changeTodoPos.valueAsNumber, changeTodoText.value);
        changeTodoPos.value = "";
        changeTodoText.value = "";
      },
      deleteTodo: (position) => {
        todoList.deleteTodo(position);
      },
      toggleTodo: () => {
        var togglePos = document.getElementById("togglePos");
        todoList.toggleCompleted(togglePos.valueAsNumber);
        togglePos.value = "";
      }
    }

    var view = {
      displayTodos: () => {
        var todosUl = document.querySelector("ul");
        todosUl.innerHTML = "";
    
        todoList.todos.forEach( (todo, position) => {
          var todoLi = document.createElement('li');
          var completed;

          todo.completed === true ? completed = "(x) " : completed = "( ) ";
          todoLi.textContent = completed + todo.todoText;
          var newButton = view.createDeleteButton();
          todoLi.id = position;
          todoLi.appendChild(newButton);
          todosUl.appendChild(todoLi);
        });
      },
      createDeleteButton: () => {
        var deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.className = 'deleteButton';
        return deleteButton;
      },
      setUpEventListener: function () {
        var todosUl = document.querySelector('ul');

        todosUl.addEventListener('click', (event) => {
          var clickedElement = event.target;
          if (clickedElement.className === 'deleteButton') {
            var liReference = clickedElement.parentElement.id;
            handlers.deleteTodo(parseInt(liReference));
            view.displayTodos();
          }
        });
      }
    }

    view.setUpEventListener();



  </script>
</body>

</html>